id: data-access
type: library
language: typescript
stack: backend
platform: node

toolchain:
  typescript:
    disabled: true

project:
  name: 'data-access'
  description: 'Data access package to access and manage our database'
  channel: '#data-access'

tasks:
  remove-build-files:
    command: rm
    args:
      - '-fr=lib/*'
    options:
      internal: true
  typecheck:
    outputs:
      - lib
    options:
      internal: true
  typecheck-cjs:
    command: 'tsc -p tsconfig.cjs.json'
    outputs:
      - lib
    options:
      internal: true
  build:
    command: './fixup.sh'
    deps:
      # - remove-build-files
      - 'utils:build'
      - typecheck
      - typecheck-cjs
  db-start:
    command: docker compose up
  db-stop:
    command: docker compose down --remove-orphans
  db-clean:
    command: docker compose down --remove-orphans -v
  schema-create:
    command: tsx src/json-to-schema.mts
    deps:
      - 'utils:build'
  migration-create:
    command: drizzle-kit generate
    args:
      - --config=./drizzle.config.ts
    deps:
      - 'utils:build'
  migration-run:
    command: tsx src/migrate.ts
    options:
      runInCI: true
    deps:
      - 'utils:build'

dependsOn:
  - utils
